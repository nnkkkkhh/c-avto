import{c as W,u as S,r as x,j as e,S as M,C as D,U as P,t as m,X as q}from"./index-C7RinoSz.js";import{u as L}from"./useQuery-DsAPcWpp.js";import{P as V}from"./plus-DYFc_zNV.js";import{P as T,M as A}from"./phone-DajP2iQW.js";import{S as z,T as E}from"./trash-2-BoQx_ah3.js";import{f as h,p as g,r as y}from"./ru-B3KvSnPF.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Q=W("chevron-down",O),b=["bg-blue-500","bg-emerald-500","bg-purple-500","bg-orange-500","bg-pink-500","bg-teal-500","bg-rose-500"];function R({patient:t,onClose:c,onSave:d}){const[a,r]=x.useState({fullName:(t==null?void 0:t.fullName)||"",phone:(t==null?void 0:t.phone)||"",email:(t==null?void 0:t.email)||"",birthDate:(t==null?void 0:t.birthDate)||"",notes:(t==null?void 0:t.notes)||""}),u=l=>{l.preventDefault(),d(a)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-5 border-b border-gray-100",children:[e.jsx("h2",{className:"text-gray-900",style:{fontSize:"1.1rem",fontWeight:600},children:t?"Редактировать пациента":"Новый пациент"}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1.5",style:{fontWeight:500},children:"Полное имя *"}),e.jsx("input",{type:"text",value:a.fullName,onChange:l=>r({...a,fullName:l.target.value}),className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50",placeholder:"Иванов Иван Иванович",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1.5",style:{fontWeight:500},children:"Телефон *"}),e.jsx("input",{type:"tel",value:a.phone,onChange:l=>r({...a,phone:l.target.value}),className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50",placeholder:"+7 (999) 000-00-00",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1.5",style:{fontWeight:500},children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:l=>r({...a,email:l.target.value}),className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50",placeholder:"ivan@mail.ru"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1.5",style:{fontWeight:500},children:"Дата рождения *"}),e.jsx("input",{type:"date",value:a.birthDate,onChange:l=>r({...a,birthDate:l.target.value}),className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1.5",style:{fontWeight:500},children:"Заметки / Анамнез"}),e.jsx("textarea",{value:a.notes,onChange:l=>r({...a,notes:l.target.value}),rows:3,className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 resize-none",placeholder:"Аллергии, особые пометки..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:c,className:"flex-1 py-2.5 border border-gray-200 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors text-sm",style:{fontWeight:500},children:"Отмена"}),e.jsx("button",{type:"submit",className:"flex-1 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors text-sm shadow-lg shadow-blue-200",style:{fontWeight:500},children:t?"Сохранить":"Добавить"})]})]})]})})}function K(){const{patients:t,addPatient:c,updatePatient:d,deletePatient:a}=S(),[r,u]=x.useState(""),[l,p]=x.useState("name"),[o,i]=x.useState(null),{isLoading:j}=L({queryKey:["patients"],queryFn:async()=>(await new Promise(s=>setTimeout(s,300)),t),initialData:t}),f=t.filter(s=>{var n;return s.fullName.toLowerCase().includes(r.toLowerCase())||s.phone.includes(r)||((n=s.email)==null?void 0:n.toLowerCase().includes(r.toLowerCase()))}).sort((s,n)=>l==="name"?s.fullName.localeCompare(n.fullName):l==="lastVisit"?new Date(n.lastVisit||"").getTime()-new Date(s.lastVisit||"").getTime():0),N=s=>{o==="new"?(c(s),m.success("Пациент успешно добавлен")):o&&(d(o.id,s),m.success("Данные пациента обновлены")),i(null)},v=(s,n)=>{confirm(`Удалить пациента ${n}?`)&&(a(s),m.success("Пациент удален"))};return j&&t.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-10 h-10 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6 max-w-[1400px]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-gray-900",style:{fontSize:"1.75rem",fontWeight:700},children:"Пациенты"}),e.jsxs("p",{className:"text-gray-500 text-sm mt-0.5",children:["Всего в базе: ",e.jsx("span",{style:{fontWeight:600},children:t.length})]})]}),e.jsxs("button",{onClick:()=>i("new"),className:"flex items-center gap-2 px-5 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors text-sm shadow-lg shadow-blue-200",style:{fontWeight:500},children:[e.jsx(V,{className:"w-4 h-4"}),"Добавить пациента"]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:r,onChange:s=>u(s.target.value),placeholder:"Поиск по имени, телефону, email...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 text-sm"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l,onChange:s=>p(s.target.value),className:"appearance-none pl-4 pr-10 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 text-sm text-gray-700",style:{fontWeight:500},children:[e.jsx("option",{value:"name",children:"По имени"}),e.jsx("option",{value:"lastVisit",children:"По последнему визиту"})]}),e.jsx(Q,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100 bg-gray-50/50",children:[e.jsx("th",{className:"text-left py-4 px-5 text-xs text-gray-500 uppercase tracking-wider",style:{fontWeight:600},children:"Пациент"}),e.jsx("th",{className:"text-left py-4 px-5 text-xs text-gray-500 uppercase tracking-wider",style:{fontWeight:600},children:"Контакты"}),e.jsx("th",{className:"text-left py-4 px-5 text-xs text-gray-500 uppercase tracking-wider",style:{fontWeight:600},children:"Дата рождения"}),e.jsx("th",{className:"text-left py-4 px-5 text-xs text-gray-500 uppercase tracking-wider",style:{fontWeight:600},children:"Последний визит"}),e.jsx("th",{className:"text-left py-4 px-5 text-xs text-gray-500 uppercase tracking-wider",style:{fontWeight:600},children:"Следующий приём"}),e.jsx("th",{className:"py-4 px-5"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:f.map((s,n)=>{const w=s.fullName.split(" ").slice(0,2).map(k=>k[0]).join(""),C=b[n%b.length];return e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"py-4 px-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 ${C} rounded-full flex items-center justify-center flex-shrink-0`,children:e.jsx("span",{className:"text-white text-xs",style:{fontWeight:600},children:w})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900 text-sm",style:{fontWeight:500},children:s.fullName}),s.notes&&e.jsx("p",{className:"text-gray-400 text-xs truncate max-w-[180px]",children:s.notes})]})]})}),e.jsx("td",{className:"py-4 px-5",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(T,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-600",children:[e.jsx(A,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.email})]})]})}),e.jsx("td",{className:"py-4 px-5 text-gray-600 text-sm",children:h(g(s.birthDate),"d MMMM yyyy",{locale:y})}),e.jsx("td",{className:"py-4 px-5",children:s.lastVisit?e.jsx("span",{className:"text-gray-600 text-sm",children:h(g(s.lastVisit),"d MMM yyyy",{locale:y})}):e.jsx("span",{className:"text-gray-300 text-sm",children:"—"})}),e.jsx("td",{className:"py-4 px-5",children:s.nextAppointment?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs",style:{fontWeight:500},children:[e.jsx(D,{className:"w-3 h-3"}),h(g(s.nextAppointment),"d MMM",{locale:y})]}):e.jsx("span",{className:"text-gray-300 text-sm",children:"—"})}),e.jsx("td",{className:"py-4 px-5",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>i(s),className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(s.id,s.fullName),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(E,{className:"w-4 h-4"})})]})})]},s.id)})})]}),f.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(P,{className:"w-12 h-12 text-gray-200 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:r?`По запросу «${r}» ничего не найдено`:"Нет пациентов"})]})]})}),o!==null&&e.jsx(R,{patient:o==="new"?null:o,onClose:()=>i(null),onSave:N})]})}export{K as default};
